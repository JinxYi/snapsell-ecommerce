<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snapsell â€¢ Sign In</title>

    <!--Frameworks and libraries-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"
        integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.min.js"
        integrity="sha384-pQQkAEnwaBkjpqZ8RU1fF1AKtTcHJwFl3pblpTlHXybJjHpMYo79HY3hIi4NKxyj"
        crossorigin="anonymous"></script>

    <!--Font Awesome-->
    <link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css">

    <!-- Styles -->
    <link rel="stylesheet" href="./theme.css">
    <link rel="stylesheet" href="./signin.css">
</head>
<body>
    <section class="wrapper">
        <form action="#" method="POST">
            <fieldset class="fieldset">
                <legend class="legend">Snapsell</legend>
                <div id="error-message">

                </div>
                <div class="input-group">
                    <label class="input-label" for="username">Username</label>
                    <input name="username" id="username" type="text"/>
                </div>
                
                <div class="input-group">
                    <label class="input-label" for="password">Password</label>
                    <input name="password" id="pwd" type="password"/>
                </div>

                <input type="submit" value="Sign In" class="submit" id="login">
            </fieldset>
        </form>
        <div class="sign-up">
            Do not have an account? <a href="signup.html" class="link">Sign up</a>
        </div>
    </section>


    <script>
        $(() => {
            $("#login").click(() => {  
                const uname = $('#username').val();
                const pwd = $('#pwd').val();

                if(uname == "" || pwd == "") {
                    $('#error-message').html(`Username and password are required!`);
                }
                else {
                    const data = `{"username": "${uname}", "password": "${pwd}"}`;
                    
                    $.ajax({                                                               
                        url: '/login',
                        type: 'POST', 
                        data: data,
                        contentType: "application/json; charset=utf-8",
                        dataType: "json"
                    })
                    .done((data, textStatus, xhr) => {  
                        if (data.token != "") {                    
                            localStorage.setItem('token', data.token);
                            localStorage.setItem('userId', data.UserData);
                            window.location.assign("home.html");
                            console.log(data.status);
                        } else {
                            console.log("Error");
                            $('#error-message').html(`Username or password is incorrect!`);
                        }                                                                 
                    })  
                    .fail((xhr, textStatus, errorThrown) => {  
                        $('#error-message').html('Error in Operation');  
                    });
                }  

                return false;
            });  
        });  
    </script>
</body>
</html>