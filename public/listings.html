<!-- 
Name: Tan Jing Yi
Class: 1B03
Admin No: 1922574
 -->
<!DOCTYPE html>
<html>
    <head>
        <title>Snapsell</title>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!--Bootstrap-->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

        <!--Fonts-->
        <link href="https://fonts.googleapis.com/css?family=Muli&display=swap" rel="stylesheet">

        <!--Font Awesome-->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

        <script> 
            const baseUrl = "http://localhost:6936";

            // Display Listing
            function displayListings(data) {
                $("#listing").html("");
                data.forEach((listings) => {
                    const postHtml = `
                    <div id=${listings.id} class="item col-3 p-3 mt-4 d-flex" style="cursor: pointer;">
                        <div class="card">
                                <div style="width:83%;margin-left:auto;margin-right:auto;margin-top:20px;height:195px;overflow:hidden;position:relative">
                                    <img src=${listings.item_pic_url} class="card-img-top align-item-center" style="max-width:100%;width:auto;overflow: auto;margin: auto;position: absolute;top: 0; left: 0; bottom: 0; right: 0;" alt="Item" >
                                </div>
                            <div class="card-body">
                                <h5 class="card-title">${listings.title}</h5>
                                <h6 class="card-subtitle">$${listings.price}</h6>
                                <p class="card-text">${listings.description}</p>
                            </div>
                            <div class="card-footer text-muted">
                                ${listings.created_at}
                            </div>
                        </div>
                    </div>
                    `

                    $("#listing").append(postHtml);
                });
            }
            
            $(document).ready(function () { 
                $.ajax({
                    url: baseUrl + '/listings',
                    type: 'GET',
                    success: function (data, textStatus, xhr) {             
                        localStorage.setItem('listing', JSON.stringify(data));
                        displayListings(data);
                    },  
                    error: function (xhr, textStatus, errorThrown) {  
                        $("#listing").append(`<h4>Please refresh your page</h4>`);
                    }
                })
                $("#myList").click(function () {
                    window.location.assign("/account.html");
                })
                $(document).on("click", ".item", function () {
                    localStorage.setItem('item', this.id);
                    window.location.assign("/details.html");
                });
                $("#search").click(function () {  
                    var keyword=$('#keyword').val();

                    var data = "{\"keyword\":\""+keyword+"\"}";
                    $.ajax({                                                               
                        url: 'http://localhost:6936/search',
                        type: 'POST', 
                        data: data,
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (data, textStatus, xhr) {
                            displayListings(data);
                        },  
                        error: function (xhr, textStatus, errorThrown) {  
                            alert("Something went wrong :(");
                            console.log('Error in Operation');  
                        }
                    });  
                    return false;
                });  
            })
        </script>
    </head>
    <body>
        <div class="container-fluid p-0">
            <nav class="navbar navbar-expand-lg navbar-light p-3 bg-danger">
                <div class="navbar-brand mb-0 h1 text-light" style="font-family: 'Muli', sans-serif;">snapsell</div>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                    aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
        
                <div class="collapse navbar-collapse">
                    <form class="form-inline my-2 ml-5">
                        <input id="keyword" class="form-control mr-sm-2" type="search" placeholder="Search products" aria-label="Search" required="required">
                        <button id="search" class="btn btn-success my-2 my-sm-0" type="submit">Search</button>
                    </form>
                </div>
                <button id="myList" class="btn btn-warning my-2 ml-auto" type="submit">My Items</button>
            </nav>
        </div>
        <div class="container">
        
            <div style="margin-top: 2rem; padding:2rem;">
                <h2 style="font-family: 'Muli', sans-serif;">Listing</h2>
                <div id="listing" class="row"> <!--Listing will appear here--> </div>
            </div>
        </div>
        

    </body>
</html>

